---
title: é¡¹ç›®ä¼˜é›…çš„å®ç°è´£ä»»é“¾æ¨¡å¼
description: ğŸ¥§æœ¬æ–‡ä¼šä»‹ç»åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä¼˜é›…çš„å®ç°è´£ä»»é“¾æ¨¡å¼
date: '2023-10-31 23:25'
swiper: false
cover: 'https://zang-1307996497.cos.ap-beijing.myqcloud.com/221347-16919360279c09.jpg'
img: 'https://zang-1307996497.cos.ap-beijing.myqcloud.com/221347-16919360279c09.jpg'
categories: è®¾è®¡æ¨¡å¼
tags:
  - æ¨¡æ¿æ¨¡å¼
  - è´£ä»»é“¾æ¨¡å¼
top: true
sticky: 2
swiper_index: 2
abbrlink: 940364b3

password: zangzang
theme: xray
message: ç§æœ‰æ–‡ç« ï¼Œä»…ä¾›è‡ªå·±å­¦ä¹ ä½¿ç”¨ã€‚
abstract: åˆ«çœ‹äº†ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯å†™ç»™è‡ªå·±çš„ #å¯†ç æ¡†æç¤ºä¿¡æ¯
wrong_pass_message: æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•! #å¯†ç é”™è¯¯æç¤ºä¿¡æ¯
---



## é¡¹ç›®ä¼˜é›…çš„å®ç°è´£ä»»é“¾æ¨¡å¼

### 1ã€åˆ›å»ºæŠ½è±¡ä¸šåŠ¡è´£ä»»é“¾ç»„ä»¶

```java
/**
 * æŠ½è±¡ä¸šåŠ¡è´£ä»»é“¾ç»„ä»¶
 * @author zang 
 * @date 2022/10/31 22:46
 */
public interface AbstractChainHandler<T> extends Ordered {

    /**
     * æ‰§è¡Œè´£ä»»é“¾é€»è¾‘
     *
     * @param requestParam è´£ä»»é“¾æ‰§è¡Œå…¥å‚
     */
    void handler(T requestParam);

    /**
     * @return è´£ä»»é“¾ç»„ä»¶æ ‡è¯†
     */
    String mark();
}
```
> ä¸Šè¾¹çš„ä»£ç ï¼Œæ˜¯è´£ä»»é“¾æ¨¡å¼ä¸­æœ€é¡¶çº§çš„è§£å¼€ handler  æ–¹æ³•ï¼Œå…¶ä»–ç»„ä»¶ç»§æ‰¿è¿™ä¸ªæ¥å£ï¼Œç„¶åå®ç° handler æ–¹æ³•ï¼Œå½“ä½œå…·ä½“çš„å®ç°
> mark()  æ–¹æ³•ï¼Œæ˜¯æ¯ä¸ªç»„ä»¶çš„æ ‡è¯†ï¼Œç”¨äºæ ‡è¯†å½“å‰æ‰§è¡Œçš„æŸä¸ªè¿‡æ»¤å™¨é“¾  {% psw è¿™ä¸ªä¼šåœ¨æŸä¸ªè¿‡æ»¤å™¨é“¾çš„é¡¶çº§æ¥å£ä¸­è®¾ç½® %}

### 2ã€åˆ›å»ºæŠ½è±¡è´£ä»»é“¾ä¸Šä¸‹æ–‡

```java

/**
 * æŠ½è±¡è´£ä»»é“¾ä¸Šä¸‹æ–‡
 *
 * @author zang
 * @date 2022/10/31 20:01
 */
public final class AbstractChainContext<T> implements CommandLineRunner {

    private final Map<String, List<AbstractChainHandler>> abstractChainHandlerContainer = new HashMap<>();

    /**
     * è´£ä»»é“¾ç»„ä»¶æ‰§è¡Œ
     *
     * @param mark         è´£ä»»é“¾ç»„ä»¶æ ‡è¯†
     * @param requestParam è¯·æ±‚å‚æ•°
     */
    public void handler(String mark, T requestParam) {
        List<AbstractChainHandler> abstractChainHandlers = abstractChainHandlerContainer.get(mark);
        if (CollectionUtils.isEmpty(abstractChainHandlers)) {
            throw new RuntimeException(String.format("[%s] Chain of Responsibility ID is undefined.", mark));
        }
        abstractChainHandlers.forEach(each -> each.handler(requestParam));
    }

    /**
     * åœ¨SpringBootå¯åŠ¨æ—¶ï¼Œå°†æ‰€æœ‰çš„è´£ä»»é“¾ç»„ä»¶æ’å¥½é¡ºåºæ³¨å†Œåˆ°å®¹å™¨ä¸­
     * 
     * @param args
     * @throws Exception
     */
    @Override
    public void run(String... args) throws Exception {
        Map<String, AbstractChainHandler> chainFilterMap = ApplicationContextHolder
                .getBeansOfType(AbstractChainHandler.class);
        chainFilterMap.forEach((beanName, bean) -> {
            List<AbstractChainHandler> abstractChainHandlers = abstractChainHandlerContainer.get(bean.mark());
            if (CollectionUtils.isEmpty(abstractChainHandlers)) {
                abstractChainHandlers = new ArrayList<>();
            }
            abstractChainHandlers.add(bean);
            List<AbstractChainHandler> actualAbstractChainHandlers = abstractChainHandlers.stream()
                    .sorted(Comparator.comparing(Ordered::getOrder))
                    .collect(Collectors.toList());
            abstractChainHandlerContainer.put(bean.mark(), actualAbstractChainHandlers);
        });
    }
}
```

### 3ã€å…·ä½“å®ç°

#### 1ã€ è¿‡æ»¤å™¨é“¾ä¸­çš„é¡¶çº§æ¥å£

```java
/**
 * ç”¨æˆ·æ³¨å†Œè´£ä»»é“¾è¿‡æ»¤å™¨
 *
 */
public interface UserRegisterCreateChainFilter<T extends UserRegisterReqDTO> extends AbstractChainHandler<UserRegisterReqDTO> {

    @Override
    default String mark() {
        return UserChainMarkEnum.USER_REGISTER_FILTER.name();
    }
}
```

#### 2ã€å…·ä½“å®ç°

```java
/**
 * ç”¨æˆ·æ³¨å†Œå‚æ•°å¿…å¡«æ£€éªŒ
 *
 */
@Component
public final class UserRegisterParamNotNullChainHandler implements UserRegisterCreateChainFilter<UserRegisterReqDTO> {

    @Override
    public void handler(UserRegisterReqDTO requestParam) {
        Map<Function<UserRegisterReqDTO, Object>, UserRegisterErrorCodeEnum> fieldCheckMap = new HashMap<>();
        fieldCheckMap.put(UserRegisterReqDTO::getUsername, UserRegisterErrorCodeEnum.USER_NAME_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getPassword, UserRegisterErrorCodeEnum.PASSWORD_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getPhone, UserRegisterErrorCodeEnum.PHONE_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getIdType, UserRegisterErrorCodeEnum.ID_TYPE_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getIdCard, UserRegisterErrorCodeEnum.ID_CARD_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getMail, UserRegisterErrorCodeEnum.MAIL_NOTNULL);
        fieldCheckMap.put(UserRegisterReqDTO::getRealName, UserRegisterErrorCodeEnum.REAL_NAME_NOTNULL);

        fieldCheckMap.forEach((fieldGetter, errorCode) -> {
            Object fieldValue = fieldGetter.apply(requestParam);
            if (Objects.isNull(fieldValue)) {
                throw new ClientException(errorCode);
            }
        });
    }

    /**
     * ç”¨æˆ·è¿”å›å½“å‰çš„çš„è¿‡æ»¤å™¨èŠ‚ç‚¹åœ¨å½“å‰è´£ä»»é“¾ä¸­çš„ä¼˜å…ˆçº§
     * @return
     */
    @Override
    public int getOrder() {
        return 0;
    }
}
```

> æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™åªéœ€è¦åœ¨ä¸šåŠ¡å±‚ï¼Œå°†æŠ½è±¡è´£ä»»é“¾ä¸Šä¸‹æ–‡æ³¨å…¥ï¼Œç„¶åæ‰§è¡Œhandler() æ–¹æ³•å°†å½“å‰è´£ä»»é“¾çš„å…·ä½“å®ç°å‘½ä¼ å…¥å°±å¯ä»¥ï¼Œ
> ä¾‹å¦‚handler(UserChainMarkEnum.USER_REGISTER_FILTER.name(), requestParam);



{% tip key %}### 3ã€åç»­æ‰©å±•{% endtip %}

> åç»­å¦‚æœéœ€è¦å¢åŠ è´£ä»»é“¾èŠ‚ç‚¹åªéœ€è¦å®ç°å¯¹åº”çš„è´£ä»»é“¾é¡¶çº§æ¥å£å°±å¯ä»¥äº†
> åç»­å¦‚æœéœ€è¦å¢åŠ æ–°çš„è´£ä»»é“¾ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå½“å‰è´£ä»»é“¾é¡¶çº§æ¥å£ï¼Œç»§æ‰¿ AbstractChainHandler ç„¶åå»åšå…·ä½“ä¸šåŠ¡å®ç°å°±å¯ä»¥äº† 
